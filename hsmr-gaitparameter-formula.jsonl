{"id":2,"name":"steps_per_minute","type":"global","requires":["events.HS_L","events.HS_R","meta.fps"],"inputs":{"HS_L":"list[frame_idx]","HS_R":"list[frame_idx]","fps":"float"},"formula":{"steps_count":"len(HS_L)+len(HS_R)","T_total_sec":"(max(last(HS_L),last(HS_R)) - min(first(HS_L),first(HS_R)))/fps","steps_per_min":"60 * steps_count / T_total_sec"},"notes":"Cadence from heel-strike counts. Use only HS within stable segment; drop partial cycles at edges."}
{"id":3,"name":"step_duration_diff_L_minus_R","type":"aggregate","requires":["events.HS_L","events.HS_R","meta.fps"],"inputs":{"HS_L":"list[frame_idx]","HS_R":"list[frame_idx]","fps":"float"},"formula":{"step_time_L_i_sec":"(HS_L[i] - prev(HS_R,HS_L[i]))/fps","step_time_R_i_sec":"(HS_R[i] - prev(HS_L,HS_R[i]))/fps","mean_step_time_L_sec":"mean_i(step_time_L_i_sec)","mean_step_time_R_sec":"mean_i(step_time_R_i_sec)","diff_sec":"mean_step_time_L_sec - mean_step_time_R_sec"},"notes":"Left step time defined from previous right HS to current left HS; right step time defined from previous left HS to current right HS. prev(A,t)=largest element of A < t."}
{"id":5,"name":"walk_cycle_time_diff_L_minus_R","type":"aggregate","requires":["events.HS_L","events.HS_R","meta.fps"],"inputs":{"HS_L":"list[frame_idx]","HS_R":"list[frame_idx]","fps":"float"},"formula":{"stride_time_L_i_sec":"(HS_L[i+1]-HS_L[i])/fps","stride_time_R_i_sec":"(HS_R[i+1]-HS_R[i])/fps","mean_stride_L_sec":"mean_i(stride_time_L_i_sec)","mean_stride_R_sec":"mean_i(stride_time_R_i_sec)","diff_sec":"mean_stride_L_sec - mean_stride_R_sec"},"notes":"Walk cycle time = stride time = HS->next HS for same foot."}
{"id":6,"name":"right_step_time","type":"aggregate","requires":["events.HS_L","events.HS_R","meta.fps"],"inputs":{"HS_L":"list[frame_idx]","HS_R":"list[frame_idx]","fps":"float"},"formula":{"step_time_R_i_sec":"(HS_R[i] - prev(HS_L,HS_R[i]))/fps","right_step_time_sec":"mean_i(step_time_R_i_sec)"},"notes":"Average right step time across all valid right HS events."}
{"id":7,"name":"left_step_time","type":"aggregate","requires":["events.HS_L","events.HS_R","meta.fps"],"inputs":{"HS_L":"list[frame_idx]","HS_R":"list[frame_idx]","fps":"float"},"formula":{"step_time_L_i_sec":"(HS_L[i] - prev(HS_R,HS_L[i]))/fps","left_step_time_sec":"mean_i(step_time_L_i_sec)"},"notes":"Average left step time across all valid left HS events."}
{"id":10,"name":"left_stride_time","type":"aggregate","requires":["events.HS_L","meta.fps"],"inputs":{"HS_L":"list[frame_idx]","fps":"float"},"formula":{"stride_time_L_i_sec":"(HS_L[i+1]-HS_L[i])/fps","left_stride_time_sec":"mean_i(stride_time_L_i_sec)"},"notes":"Time from first contact of left foot to next contact of left foot."}
{"id":11,"name":"right_stride_time","type":"aggregate","requires":["events.HS_R","meta.fps"],"inputs":{"HS_R":"list[frame_idx]","fps":"float"},"formula":{"stride_time_R_i_sec":"(HS_R[i+1]-HS_R[i])/fps","right_stride_time_sec":"mean_i(stride_time_R_i_sec)"},"notes":"Time from first contact of right foot to next contact of right foot."}
{"id":16,"name":"left_swing_percent","type":"aggregate","requires":["events.HS_L","events.TO_L","meta.fps"],"inputs":{"HS_L":"list[frame_idx]","TO_L":"list[frame_idx]","fps":"float"},"formula":{"stride_L_i_sec":"(HS_L[i+1]-HS_L[i])/fps","swing_L_i_sec":"(HS_L[i+1]-TO_L[i])/fps","swing_L_i_pct":"100 * swing_L_i_sec / stride_L_i_sec","left_swing_percent":"mean_i(swing_L_i_pct)"},"notes":"Swing defined as TO->next HS of same foot. Assumes TO_L[i] lies in [HS_L[i],HS_L[i+1])."}
{"id":17,"name":"right_swing_percent","type":"aggregate","requires":["events.HS_R","events.TO_R","meta.fps"],"inputs":{"HS_R":"list[frame_idx]","TO_R":"list[frame_idx]","fps":"float"},"formula":{"stride_R_i_sec":"(HS_R[i+1]-HS_R[i])/fps","swing_R_i_sec":"(HS_R[i+1]-TO_R[i])/fps","swing_R_i_pct":"100 * swing_R_i_sec / stride_R_i_sec","right_swing_percent":"mean_i(swing_R_i_pct)"},"notes":"Swing defined as TO->next HS of same foot. Assumes TO_R[i] lies in [HS_R[i],HS_R[i+1])."}
{"id":18,"name":"left_swing_time","type":"aggregate","requires":["events.HS_L","events.TO_L","meta.fps"],"inputs":{"HS_L":"list[frame_idx]","TO_L":"list[frame_idx]","fps":"float"},"formula":{"swing_L_i_sec":"(HS_L[i+1]-TO_L[i])/fps","left_swing_time_sec":"mean_i(swing_L_i_sec)"},"notes":"Time left foot off-ground per left stride (TO to next HS)."}
{"id":19,"name":"right_swing_time","type":"aggregate","requires":["events.HS_R","events.TO_R","meta.fps"],"inputs":{"HS_R":"list[frame_idx]","TO_R":"list[frame_idx]","fps":"float"},"formula":{"swing_R_i_sec":"(HS_R[i+1]-TO_R[i])/fps","right_swing_time_sec":"mean_i(swing_R_i_sec)"},"notes":"Time right foot off-ground per right stride (TO to next HS)."}
{"id":20,"name":"left_only_support_percent_within_left_stride","type":"aggregate","requires":["events.HS_L","events.TO_L","events.HS_R","events.TO_R","meta.fps"],"inputs":{"HS_L":"list[frame_idx]","TO_L":"list[frame_idx]","HS_R":"list[frame_idx]","TO_R":"list[frame_idx]","fps":"float"},"formula":{"W_L_i":"[HS_L[i], HS_L[i+1]]","L_stance_i":"[HS_L[i], TO_L[i]]","R_stance_intervals":"[{[HS_R[j],TO_R[j]] for all j}]","T_Lonly_i_sec":"overlap_len_sec(W_L_i, L_stance_i, NOT R_stance_intervals, fps)","T_stride_L_i_sec":"(HS_L[i+1]-HS_L[i])/fps","pct_Lonly_i":"100 * T_Lonly_i_sec / T_stride_L_i_sec","left_only_support_percent":"mean_i(pct_Lonly_i)"},"notes":"Single-support-left within left stride = time when left stance true and right stance false. overlap_len_sec computes total duration inside W where condition holds."}
{"id":21,"name":"right_only_support_percent_within_right_stride","type":"aggregate","requires":["events.HS_R","events.TO_R","events.HS_L","events.TO_L","meta.fps"],"inputs":{"HS_R":"list[frame_idx]","TO_R":"list[frame_idx]","HS_L":"list[frame_idx]","TO_L":"list[frame_idx]","fps":"float"},"formula":{"W_R_i":"[HS_R[i], HS_R[i+1]]","R_stance_i":"[HS_R[i], TO_R[i]]","L_stance_intervals":"[{[HS_L[j],TO_L[j]] for all j}]","T_Ronly_i_sec":"overlap_len_sec(W_R_i, R_stance_i, NOT L_stance_intervals, fps)","T_stride_R_i_sec":"(HS_R[i+1]-HS_R[i])/fps","pct_Ronly_i":"100 * T_Ronly_i_sec / T_stride_R_i_sec","right_only_support_percent":"mean_i(pct_Ronly_i)"},"notes":"Single-support-right within right stride = time when right stance true and left stance false."}
{"id":22,"name":"left_only_support_duration_within_left_stride","type":"aggregate","requires":["events.HS_L","events.TO_L","events.HS_R","events.TO_R","meta.fps"],"inputs":{"HS_L":"list[frame_idx]","TO_L":"list[frame_idx]","HS_R":"list[frame_idx]","TO_R":"list[frame_idx]","fps":"float"},"formula":{"T_Lonly_i_sec":"overlap_len_sec([HS_L[i],HS_L[i+1]], [HS_L[i],TO_L[i]], NOT {[HS_R[j],TO_R[j]]}, fps)","left_only_support_duration_sec":"mean_i(T_Lonly_i_sec)"},"notes":"Duration (seconds) when only left foot contacts ground within each left stride; then averaged."}
{"id":23,"name":"right_only_support_duration_within_right_stride","type":"aggregate","requires":["events.HS_R","events.TO_R","events.HS_L","events.TO_L","meta.fps"],"inputs":{"HS_R":"list[frame_idx]","TO_R":"list[frame_idx]","HS_L":"list[frame_idx]","TO_L":"list[frame_idx]","fps":"float"},"formula":{"T_Ronly_i_sec":"overlap_len_sec([HS_R[i],HS_R[i+1]], [HS_R[i],TO_R[i]], NOT {[HS_L[j],TO_L[j]]}, fps)","right_only_support_duration_sec":"mean_i(T_Ronly_i_sec)"},"notes":"Duration (seconds) when only right foot contacts ground within each right stride; then averaged."}
{"id":24,"name":"double_support_percent_within_left_stride","type":"aggregate","requires":["events.HS_L","events.TO_L","events.HS_R","events.TO_R","meta.fps"],"inputs":{"HS_L":"list[frame_idx]","TO_L":"list[frame_idx]","HS_R":"list[frame_idx]","TO_R":"list[frame_idx]","fps":"float"},"formula":{"W_L_i":"[HS_L[i],HS_L[i+1]]","T_double_L_i_sec":"overlap_len_sec(W_L_i, {[HS_L[i],TO_L[i]]}, AND {[HS_R[j],TO_R[j]]}, fps)","T_stride_L_i_sec":"(HS_L[i+1]-HS_L[i])/fps","pct_double_L_i":"100 * T_double_L_i_sec / T_stride_L_i_sec","double_support_percent_left_stride":"mean_i(pct_double_L_i)"},"notes":"Double support within left stride = time when both stance intervals overlap inside W_L."}
{"id":25,"name":"double_support_percent_within_right_stride","type":"aggregate","requires":["events.HS_R","events.TO_R","events.HS_L","events.TO_L","meta.fps"],"inputs":{"HS_R":"list[frame_idx]","TO_R":"list[frame_idx]","HS_L":"list[frame_idx]","TO_L":"list[frame_idx]","fps":"float"},"formula":{"W_R_i":"[HS_R[i],HS_R[i+1]]","T_double_R_i_sec":"overlap_len_sec(W_R_i, {[HS_R[i],TO_R[i]]}, AND {[HS_L[j],TO_L[j]]}, fps)","T_stride_R_i_sec":"(HS_R[i+1]-HS_R[i])/fps","pct_double_R_i":"100 * T_double_R_i_sec / T_stride_R_i_sec","double_support_percent_right_stride":"mean_i(pct_double_R_i)"},"notes":"Double support within right stride = time when both feet are in stance inside W_R."}
{"id":26,"name":"double_support_duration_within_left_stride","type":"aggregate","requires":["events.HS_L","events.TO_L","events.HS_R","events.TO_R","meta.fps"],"inputs":{"HS_L":"list[frame_idx]","TO_L":"list[frame_idx]","HS_R":"list[frame_idx]","TO_R":"list[frame_idx]","fps":"float"},"formula":{"T_double_L_i_sec":"overlap_len_sec([HS_L[i],HS_L[i+1]], {[HS_L[i],TO_L[i]]}, AND {[HS_R[j],TO_R[j]]}, fps)","double_support_duration_left_stride_sec":"mean_i(T_double_L_i_sec)"},"notes":"Duration (seconds) when both feet contact ground within each left stride; then averaged."}
{"id":27,"name":"double_support_duration_within_right_stride","type":"aggregate","requires":["events.HS_R","events.TO_R","events.HS_L","events.TO_L","meta.fps"],"inputs":{"HS_R":"list[frame_idx]","TO_R":"list[frame_idx]","HS_L":"list[frame_idx]","TO_L":"list[frame_idx]","fps":"float"},"formula":{"T_double_R_i_sec":"overlap_len_sec([HS_R[i],HS_R[i+1]], {[HS_R[i],TO_R[i]]}, AND {[HS_L[j],TO_L[j]]}, fps)","double_support_duration_right_stride_sec":"mean_i(T_double_R_i_sec)"},"notes":"Duration (seconds) when both feet contact ground within each right stride; then averaged."}
{"_meta_event_detection","name":"derive_HS_TO_from_pose_time_series","type":"helper","uses_pose_params":["knee_angle_l","knee_angle_r","hip_flexion_l","hip_flexion_r","ankle_angle_l","ankle_angle_r","mtp_angle_l","mtp_angle_r"],"inputs":{"pose":"array[T,46] indexed by pose_param_names","fps":"float"},"procedure":{"signals":["knee_angle_l(t)","knee_angle_r(t)"],"preprocess":["apply_savgol_or_lowpass(knee_angle_*, cutoffâ‰ˆ6Hz)","optional: smooth hip_flexion_* for corroboration"],"peak_detection":{"mid_swing_peak":"find_peaks(knee_angle_*, prominence>=p, distance>=d_frames)","HS_candidate":"for each peak at tp: search post-window [tp+w1, tp+w2] for local minimum (knee most extended) => HS","TO_candidate":"for each peak at tp: search pre-window [tp-w2, tp-w1] for local minimum (end-stance) => TO"},"constraints":["enforce HS(i) < TO(i) < HS(i+1) per foot","enforce alternation between L and R HS (most sequences)","reject events producing step_time outside [0.25,1.2] sec or stride_time outside [0.5,2.5] sec (tune per cohort)"],"outputs":{"HS_L":"list[frame_idx]","TO_L":"list[frame_idx]","HS_R":"list[frame_idx]","TO_R":"list[frame_idx]"}},"notes":"This is the minimum angle-only approach. If you later have foot XYZ/heel height, replace with contact-from-velocity/height for higher accuracy."}
